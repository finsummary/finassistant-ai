# Исправление проблем с Categories и Reports (показывает 0.00)

## Проблема

Страницы Categories и Reports показывают 0.00 везде, хотя транзакции загружены.

## Причина

API `/api/reports/summary` **не фильтровал транзакции по `user_id`**, поэтому:
- Если миграции не выполнены - таблицы могут отсутствовать
- Если RLS не настроен правильно - данные не возвращаются
- Если нет фильтрации по `user_id` - могут возвращаться пустые данные

## Исправление

Я исправил API `/api/reports/summary`:
- ✅ Добавил фильтрацию по `user_id` (`.eq('user_id', userId)`)
- ✅ Используется `requireAuth()` для получения `userId`

## Что нужно проверить

### 1. Выполнены ли миграции?

**ВАЖНО**: Миграции нужно выполнить!

1. **Supabase Dashboard:**
   - https://supabase.com/dashboard
   - Проект "FinAssistant.ai"

2. **SQL Editor:**
   - Левое меню → "SQL Editor"
   - "New query"

3. **Выполните миграции:**
   - Откройте: `finassistant-ai/supabase/migrations/ALL_MIGRATIONS.sql`
   - Скопируйте весь содержимое
   - Вставьте в SQL Editor
   - Нажмите "Run"

4. **Проверьте таблицы:**
   - Database → Tables
   - Должны быть: `Categories`, `Transactions`, `TransactionCategories`

### 2. Назначены ли категории транзакциям?

**Проверка:**
1. Откройте Dashboard
2. Найдите транзакции в списке
3. У каждой транзакции есть выпадающий список "Category"
4. Если категории не назначены - они будут "Uncategorized"

**Как назначить категории:**
1. **Вручную:** выберите категорию из выпадающего списка для каждой транзакции
2. **AI Categorize:** нажмите кнопку "AI Categorize" на Dashboard (автоматически назначит категории)

### 3. Есть ли категории в базе?

**Проверка:**
1. Откройте: Settings → Categories
2. Должен быть список категорий (Income и Expense)
3. Если список пустой - создайте категории вручную

**Если категорий нет:**
Миграции должны создать дефолтные категории. Если их нет:
1. Settings → Categories
2. Нажмите "Add" для создания новых категорий

## После исправления

1. **Перезапустите dev server** (если изменения не применились автоматически)
2. **Обновите страницы:**
   - Reports (`F5`)
   - Categories (`F5`)

3. **Проверьте:**
   - Если транзакции категоризированы → данные должны появиться
   - Если транзакции НЕ категоризированы → будет "Uncategorized" с суммами

## Ожидаемый результат

После исправления и назначения категорий:

✅ **Categories page:**
- Показывает категории с суммами
- Доходы и расходы разделены

✅ **Reports page:**
- Показывает данные по категориям
- Показывает месячные итоги
- Показывает общие итоги

## Если все еще 0.00

Проверьте:
1. ✅ Миграции выполнены?
2. ✅ Транзакции категоризированы? (не "Uncategorized")
3. ✅ Категории существуют в базе? (Settings → Categories)

Если все это проверено, но проблема сохраняется - сообщите, какие ошибки в консоли браузера (F12).
